(function(b,a){b.Easing={Linear:{},Quadratic:{},Cubic:{},Quartic:{},Quintic:{},Sinusoidal:{},Exponential:{},Circular:{},Elastic:{},Back:{},Bounce:{}};b.Easing.Linear.EaseNone=function(c){return c};b.Easing.Quadratic.EaseIn=function(c){return c*c};b.Easing.Quadratic.EaseOut=function(c){return -c*(c-2)};b.Easing.Quadratic.EaseInOut=function(c){if((c*=2)<1){return 0.5*c*c}return -0.5*(--c*(c-2)-1)};b.Easing.Cubic.EaseIn=function(c){return c*c*c};b.Easing.Cubic.EaseOut=function(c){return --c*c*c+1};b.Easing.Cubic.EaseInOut=function(c){if((c*=2)<1){return 0.5*c*c*c}return 0.5*((c-=2)*c*c+2)};b.Easing.Quartic.EaseIn=function(c){return c*c*c*c};b.Easing.Quartic.EaseOut=function(c){return -(--c*c*c*c-1)};b.Easing.Quartic.EaseInOut=function(c){if((c*=2)<1){return 0.5*c*c*c*c}return -0.5*((c-=2)*c*c*c-2)};b.Easing.Quintic.EaseIn=function(c){return c*c*c*c*c};b.Easing.Quintic.EaseOut=function(c){return(c=c-1)*c*c*c*c+1};b.Easing.Quintic.EaseInOut=function(c){if((c*=2)<1){return 0.5*c*c*c*c*c}return 0.5*((c-=2)*c*c*c*c+2)};b.Easing.Sinusoidal.EaseIn=function(c){return -Math.cos(c*Math.PI/2)+1};b.Easing.Sinusoidal.EaseOut=function(c){return Math.sin(c*Math.PI/2)};b.Easing.Sinusoidal.EaseInOut=function(c){return -0.5*(Math.cos(Math.PI*c)-1)};b.Easing.Exponential.EaseIn=function(c){return c===0?0:Math.pow(2,10*(c-1))};b.Easing.Exponential.EaseOut=function(c){return c===1?1:-Math.pow(2,-10*c)+1};b.Easing.Exponential.EaseInOut=function(c){if(c===0){return 0}if(c===1){return 1}if((c*=2)<1){return 0.5*Math.pow(2,10*(c-1))}return 0.5*(-Math.pow(2,-10*(c-1))+2)};b.Easing.Circular.EaseIn=function(c){return -(Math.sqrt(1-c*c)-1)};b.Easing.Circular.EaseOut=function(c){return Math.sqrt(1- --c*c)};b.Easing.Circular.EaseInOut=function(c){if((c/=0.5)<1){return -0.5*(Math.sqrt(1-c*c)-1)}return 0.5*(Math.sqrt(1-(c-=2)*c)+1)};b.Easing.Elastic.EaseIn=function(d){var e,c=0.1,f=0.4;if(d==0){return 0}if(d==1){return 1}if(!f){f=0.3}if(!c||c<1){c=1;e=f/4}else{e=f/(2*Math.PI)*Math.asin(1/c)}return -(c*Math.pow(2,10*(d-=1))*Math.sin((d-e)*(2*Math.PI)/f))};b.Easing.Elastic.EaseOut=function(d){var e,c=0.1,f=0.4;if(d==0){return 0}if(d==1){return 1}if(!f){f=0.3}if(!c||c<1){c=1;e=f/4}else{e=f/(2*Math.PI)*Math.asin(1/c)}return(c*Math.pow(2,-10*d)*Math.sin((d-e)*(2*Math.PI)/f)+1)};b.Easing.Elastic.EaseInOut=function(d){var e,c=0.1,f=0.4;if(d==0){return 0}if(d==1){return 1}if(!f){f=0.3}if(!c||c<1){c=1;e=f/4}else{e=f/(2*Math.PI)*Math.asin(1/c)}if((d*=2)<1){return -0.5*(c*Math.pow(2,10*(d-=1))*Math.sin((d-e)*(2*Math.PI)/f))}return c*Math.pow(2,-10*(d-=1))*Math.sin((d-e)*(2*Math.PI)/f)*0.5+1};b.Easing.Back.EaseIn=function(c){var d=1.70158;return c*c*((d+1)*c-d)};b.Easing.Back.EaseOut=function(c){var d=1.70158;return(c=c-1)*c*((d+1)*c+d)+1};b.Easing.Back.EaseInOut=function(c){var d=1.70158*1.525;if((c*=2)<1){return 0.5*(c*c*((d+1)*c-d))}return 0.5*((c-=2)*c*((d+1)*c+d)+2)};b.Easing.Bounce.EaseIn=function(c){return 1-b.Easing.Bounce.EaseOut(1-c)};b.Easing.Bounce.EaseOut=function(c){if((c/=1)<(1/2.75)){return 7.5625*c*c}else{if(c<(2/2.75)){return 7.5625*(c-=(1.5/2.75))*c+0.75}else{if(c<(2.5/2.75)){return 7.5625*(c-=(2.25/2.75))*c+0.9375}else{return 7.5625*(c-=(2.625/2.75))*c+0.984375}}}};b.Easing.Bounce.EaseInOut=function(c){if(c<0.5){return b.Easing.Bounce.EaseIn(c*2)*0.5}return b.Easing.Bounce.EaseOut(c*2-1)*0.5+0.5}})(this.Backbone,this._);(function(i,j,e){var d={duration:400,easing:""},k={Webkit:"webkit",Moz:"",O:"o",ms:"ms"},g=window.document,b=g.createElement("div"),f="",h="",c=["scale","scaleX","scaleY","scale3d","rotate","rotateX","rotateY","rotateZ","rotate3d","translate","translateX","translateY","translateZ","translate3d","skew","skewX","skewY","matrix","matrix3d","perspective"];e.each(k,function(l,m){if(b.style[l+"TransitionProperty"]!==undefined){h=l;i.prefix=f="-"+l.toLowerCase()+"-";return false}});var a={transition:f+"transition",transform:f+"transform",transitionEnd:h+"TransitionEnd"};e.fn.transform=function(m){var n=[];for(var l in m){if(j.indexOf(c,l)!==-1){n.push(l+"("+m[l]+")");delete m[l]}}if(n.length){m[a.transform]=n.join(" ")}return e(this).css(m)};e.fn.stop=function(){var l={};l[f+"transition"]=l[f+"animation-name"]="none";e(this).css(l)};e.fn.gfxSlideIn=function(n,r){var l=e(this),o=e.extend({},d,n||{}),q,m,p;o.direction=o.direction||"right";q=o.distance||100;if(o.direction==="left"||o.direction==="up"){q*=-1}q+="%";m=o.fade?0:1;if(o.direction==="up"||o.direction==="down"){p="0,"+q+",0"}else{p=q+",0,0"}l.transform({translate3d:p,opacity:m}).show();l.animate({translate3d:"0,0,0",opacity:1},o.duration,o.easing,r)};e.fn.gfxSlideOut=function(n,r){var l=e(this),o=e.extend({},d,n||{}),q,m,p="0,0,0";o.direction=o.direction||"right";q=o.distance||100;if(o.direction==="left"||o.direction==="up"){q*=-1}q+="%";m=o.fade?0:1;if(o.direction==="up"||o.direction==="down"){p="0,"+q+",0"}else{p=q+",0,0"}l.show().animate({translate3d:p,opacity:m},o.duration,o.easing,function(){l.transform({translate3d:"0,0,0",opacity:1}).hide();if(r){r.call()}})};e.fn.gfxFadeIn=function(m,o){var l=e(this),n=e.extend({},d,m||{});n.duration=n.duration||1000;l.css({opacity:0}).show().animate({opacity:1},n.duration,n.easing,o)};e.fn.gfxFadeOut=function(m,o){var l=e(this),n=e.extend({},d,m||{});l.css({opacity:1}).animate({opacity:0},n.duration,n.easing,function(){l.hide().css({opacity:1});if(o){o.call()}})}})(this.Backbone,this._,Zepto);(function(g,h){var d,e,f=50,c=1,a=false,i=window.requestAnimationFrame||window.webkitRequestAnimationFrame||window.mozRequestAnimationFrame||window.oRequestAnimationFrame||window.msRequestAnimationFrame||null;var b=function(){this.listeners=[]};h.extend(b.prototype,g.Events,{events:{CORE_ANIMATION_STOP:"CoreAnimation:stop",CORE_ANIMATION_FRAME:"CoreAnimation:frame"},initialize:function(){var j=this;h.bindAll(this);c=1;a=true;if(i){d=function(){if(d){e=i(d);j.step()}};d()}else{d=setInterval(this.step,1000/f)}},stop:function(){a=false;if(typeof d==="number"){clearInterval(d)}var j=window.cancelRequestAnimationFrame||window.webkitCancelRequestAnimationFrame||window.mozCancelRequestAnimationFrame||window.oCancelRequestAnimationFrame||window.msCancelRequestAnimationFrame||null;if(j){j(e)}d=null;this.off();this.trigger(this.events.CORE_ANIMATION_STOP)},step:function(){if(!this.listeners.length){this.stop();return}console.log("CORE :: ANIM :: STEP");this.trigger(this.events.CORE_ANIMATION_FRAME,{frame:c++})},registerListener:function(j){console.log("CORE :: REGISTER LISTENER :: "+j);this.listeners.push(j);if(!a){this.initialize()}},removeListener:function(k){console.log("CORE :: REMOVE LISTENER :: "+k);var j=h.indexOf(this.listeners,k);this.listeners.splice(j,1);console.log("CORE :: LISTENERS :: "+this.listeners)}});g.CoreAnimation=new b()})(this.Backbone,this._);(function(c,a){var b=c.CoreAnimation;c.Animation=function(){this.tweens=[];this.map=[]};a.extend(c.Animation.prototype,c.Events,{tween:function(d){return this.addTween(this,d)},delay:function(d){return this.addTween(null,d)},addTween:function(g,e){var f=new c.Tween(g,e),d=this;f.on(f.events.TWEEN_COMPLETE,function(){d.removeTween(f)});this.tweens.push(f);return f},removeTween:function(e){e.stop();var d=a.indexOf(this.tweens,e);this.tweens.splice(d,1)},removeAllTweens:function(){for(var e=0,d=this.tweens.length;e<d;e++){this.tweens[e].stop()}this.tweens.length=0}});c.Tween=function(e,d){this.tid=a.uniqueId("tween_");this.obj=e;this.to=d.to||{};this._currentValues={};this._startValues={};this.startTime=null;this.elapsed=0;this.elapsedTime=0;this.delay=d.delay||0;this.duration=d.duration||1000;this.easing=d.easing||c.Easing.Linear.EaseNone;this.progress=d.progress||null;this.callback=d.complete||null;this.start()};a.extend(c.Tween.prototype,c.Events,{events:{TWEEN_COMPLETE:"Backbone.Tween:complete"},listen:function(){this.listening=true;b.registerListener(this.tid);b.on(b.events.CORE_ANIMATION_FRAME,this.step,this)},stopListening:function(){console.log("STOP LISTENER :: "+this.tid);this.listening=false;b.off(b.events.CORE_ANIMATION_FRAME,this.step,this);b.removeListener(this.tid)},start:function(){var d=this.to,f=this.obj,e;this.startTime=Date.now()+this.delay;if(f){for(e in d){if(f[e]===null){continue}this._startValues[e]=f[e];this._currentValues[e]=d[e]-f[e]}}this.listen();return this},stop:function(){console.log("CORE :: STOP TWEEN");this.elapsedTime=Date.now()-this.startTime;this.stopListening();return this},getElapsedTime:function(){return this.elapsedTime},step:function(){var g=Date.now(),f,d=this._currentValues,h=this._startValues,e;if(g<this.startTime){return false}this.elapsed=(g-this.startTime)/this.duration;this.elapsed=this.elapsed>1?1:this.elapsed;f=this.easing(this.elapsed);if(this.obj){for(e in d){this.obj[e]=h[e]+d[e]*f}this.obj.draw()}if(this.progress){this.progress.call(this.obj,f)}if(this.elapsed==1){this.stopListening();if(this.callback){this.callback.call(this.obj);this.trigger(this.events.TWEEN_COMPLETE)}}}})})(this.Backbone,this._);(function(c,a,b){c.Element=c.View.extend({className:"element"});a.extend(c.Element.prototype,new c.Animation(),{x:0,y:0,scale:1,alpha:1,enabled:true,initialize:function(){},set:function(d,f,g){var e=g||true;this[d]=f;if(e){this.draw()}return this},attr:function(d,h){var g={},f=h||true;for(var e in d){if(this[e]!==d[e]){g[e]=d[e]}}a.extend(this,g);if(f){this.draw()}return this},css:function(d){this.$el.css(d);return this},draw:function(){var e={},d=[];if(this.w!==undefined){if(typeof this.w==="number"){e.width=Math.floor(this.w)+"px"}else{if(typeof this.w==="string"){e.width=this.w}}}if(this.h!==undefined){if(typeof this.h==="number"){e.height=Math.floor(this.h)+"px"}else{if(typeof this.h==="string"){e.height=this.h}}}if(this.z!==undefined){e.zIndex=this.z}if(this.alpha!==undefined){e.opacity=this.alpha}if(b.csstransforms3d){d.push("translate3d("+(Math.floor(this.x))+"px,"+(Math.floor(this.y))+"px,0)");if(this.rotation!==undefined){d.push("rotateZ("+this.rotation+"deg)")}}else{e.left=Math.floor(this.x)+"px";e.top=Math.floor(this.y)+"px";if(this.rotation!==undefined){d.push("rotate("+this.rotation+"deg)")}}if(this.scale!==undefined){d.push("scale("+this.scale+")")}if(d.length){e.transform=d.join(" ");e[c.prefix+"transform"]=d.join(" ")}this.css(e)}})})(this.Backbone,this._,this.Modernizr);(function(c,a,b){c.Scene=c.Element.extend({className:"scene"});a.extend(c.Scene.prototype,{children:null,enabled:true,initialize:function(){},show:function(){this.$el.show()},hide:function(){this.$el.hide();this.destroy()},fadeIn:function(d){this.$el.gfxFadeIn({duration:1000},d)},fadeOut:function(d){this.$el.gfxFadeOut({duration:1000},a.bind(this.cleanup,this,d))},slideIn:function(e,d){this.$el.gfxSlideIn({duration:1000,distance:e},d)},slideOut:function(e,d){this.$el.gfxSlideOut({duration:1000,distance:e},a.bind(this.cleanup,this,d))},cleanup:function(d){if(d){d.call()}if(this.destroy){this.destroy()}},renderTemplate:function(e,f,d){this.$el.html(this.compileTemplate(e,f));d.append(this.$el)},compileTemplate:function(e,f){var d=a.template(e,f);return d},fetchTemplate:function(e,f){var d=this;b.get(e,function(g){f.call(d,g)})},addElement:function(d,e){if(this.children===null){this.children={}}this.children[d]=e;return this.children[d]},removeElement:function(d){this.children[d].remove();delete this.children[d]},removeAll:function(){this.children=null},get:function(d){return this.children[d]},destroy:function(){console.log("DESTROY");this.remove();this.off();this.removeAll();if(this.removeAllTweens){this.removeAllTweens()}if(this.model){this.model.destroy()}}})})(this.Backbone,this._,Zepto);(function(d,a,b){var c=d.Model.extend({});d.Stage=d.Scene.extend({el:"body",model:new c(),router:null,EVENTS:{STAGE_RESIZE:"stage/resize",STAGE_SCENE_CHANGE:"stage/scene/change"},initialize:function(f){var e=this;this.$el.addClass("stage");if(f===undefined||f.footer!==false){this.footer=new d.Element({tagName:"footer"});this.$el.prepend(this.footer.$el)}this.content=new d.Element({tagName:"article",className:"viewport"});this.$el.prepend(this.content.$el);if(f===undefined||f.header!==false){this.header=new d.Element({tagName:"header"});this.$el.prepend(this.header.$el)}this.resize(window.innerWidth||(window.document.documentElement.clientWidth||window.document.body.clientWidth),window.innerHeight||(window.document.documentElement.clientHeight||window.document.body.clientHeight));this.render();b(window).on("resize",function(){e.resize(window.innerWidth||(window.document.documentElement.clientWidth||window.document.body.clientWidth),window.innerHeight||(window.document.documentElement.clientHeight||window.document.body.clientHeight));e.trigger(e.EVENTS.STAGE_RESIZE)})},render:function(){},resize:function(e,g){var f="portrait";if(e>g){f="landscape"}this.model.set({width:Math.floor(e),height:Math.floor(g),halfWidth:Math.floor(e/2),halfHeight:Math.floor(g/2),orientation:f})},changeScene:function(g,e){var f=this.model.get("scene");if(f){f.hide()}this.model.set({scene:g,sceneName:e});g.render(this.content.$el);this.trigger(this.EVENTS.STAGE_SCENE_CHANGE,g,e)},currentScene:function(){return this.model.get("scene")},currentSceneName:function(){return this.model.get("sceneName")},calcWidth:function(e){return Math.floor(this.model.get("width")*e)},calcHeight:function(e){return Math.floor(this.model.get("height")*e)},stageWidth:function(){return this.model.get("width")},stageHeight:function(){return this.model.get("height")},stageOrientation:function(){return this.model.get("orientation")}})}).call(this,this.Backbone,this._,Zepto);(function(e,c,d){var b=e.CoreAnimation;var a=function(){this.ready=false};c.extend(a.prototype,e.Events,{EVENTS:{PAUSE:"pause",RESUME:"resume"},initialize:function(){var f=d(document);f.on(this.EVENTS.PAUSE,this.pause);f.on(this.EVENTS.RESUME,this.resume)},pause:function(){b.stop()},resume:function(){b.initialize()},connection:function(){var f=navigator.network.connection.type;return f},getCurrentPosition:function(g,f){navigator.geolocation.getCurrentPosition(g,f)}});e.PhoneGap=new a()})(this.Backbone,this._,Zepto);